{{.B}}NAME{{.R}}
       mksvc - hardened systemd service generator

{{.B}}SYNOPSIS{{.R}}
       {{.B}}mksvc{{.R}} <name> <path> [options]
       {{.B}}mksvc{{.R}} [options]                  {{.U}}# if conf/svc.yml exists{{.R}}

{{.B}}DESCRIPTION{{.R}}
       mksvc generates production-ready systemd unit files with secure defaults.
       Creates service units, sysusers configs, logrotate rules and setup/un-
       install scripts. Configuration is saved to conf/svc.yml for later runs.

{{.B}}OPTIONS{{.R}}
       {{.B}}-h, --help{{.R}}          Show this help page
       {{.B}}-v, --version{{.R}}       Print version and exit
       {{.B}}-i, --interactive{{.R}}   Configure via prompts (saved as defaults)
       {{.B}}-n, --dry-run{{.R}}       Preview configuration without writing files
       {{.B}}--env-file{{.R}} <path>   Load environment variables from file

{{.B}}CAPABILITY FLAGS{{.R}}
       All flags support {{.B}}--flag{{.R}} (enable) and {{.B}}--no-flag{{.R}} (disable).
       These override saved configuration and interactive choices.

   {{.U}}Core Options{{.R}}
       {{.B}}--network{{.R}}             Network access                    (default: on)
       {{.B}}--listening{{.R}}           Server mode / port binding        (default: on)
       {{.B}}--privileged-ports{{.R}}    Bind to ports < 1024             (default: off)
       {{.B}}--exec-memory{{.R}}         JIT / executable memory          (default: off)
       {{.B}}--writable{{.R}}            Writable working directory       (default: off)
       {{.B}}--runtime-dir{{.R}}         Create /run/<name>               (default: off)
       {{.B}}--devices{{.R}}             Hardware device access           (default: off)
       {{.B}}--full-devices{{.R}}        Unrestricted device access       (default: off)
       {{.B}}--subprocess{{.R}}          Shell / subprocess execution     (default: off)
       {{.B}}--log-dir{{.R}}             Separate logs subdirectory       (default: on)

   {{.U}}Advanced Security{{.R}}
       {{.B}}--localhost-only{{.R}}      Restrict network to localhost    (default: off)
       {{.B}}--private-users{{.R}}       User namespace isolation         (default: off)

   {{.U}}Resource Limits{{.R}}
       {{.B}}--cpu-quota{{.R}} <val>     CPU quota (e.g., 200% for 2 cores)
       {{.B}}--memory-max{{.R}} <val>    Memory limit (e.g., 2G, 512M)

{{.B}}CONFIGURATION REFERENCE{{.R}}
   {{.B}}Network Access{{.R}} (--network)
       Controls IPv4/IPv6 networking. When disabled, creates a private network
       namespace with only loopback, blocking all external communication.

       {{.U}}Enable:{{.R}}  Web servers, APIs, database clients, anything using TCP/UDP.
       {{.U}}Disable:{{.R}} File processors, offline cron jobs, local-only tools.

   {{.B}}Server Mode{{.R}} (--listening)
       Allows binding to network ports. When disabled, blocks bind() syscalls
       via SocketBindDeny=any. Changes startup dependency to network-online.tar-
       get ensuring the network is fully configured before starting.

       {{.U}}Enable:{{.R}}  HTTP servers, gRPC services, anything accepting connections.
       {{.U}}Disable:{{.R}} Outbound-only clients (scrapers, bots, webhook senders).

   {{.B}}Privileged Ports{{.R}} (--privileged-ports)
       Allows binding to ports below 1024 (80, 443) by granting the capability
       CAP_NET_BIND_SERVICE to the process.

       {{.U}}Enable:{{.R}}  Direct exposure without reverse proxy (rare).
       {{.U}}Disable:{{.R}} Almost always. Use nginx as reverse proxy or high ports.

   {{.B}}Executable Memory{{.R}} (--exec-memory)
       Allows memory pages that are both writable and executable. Required for
       JIT compilation. Disables MemoryDenyWriteExecute when enabled.

       {{.U}}Enable:{{.R}}  Node.js, Java, PHP, Python w/ native extensions, wazero/WASM.
       {{.U}}Disable:{{.R}} Pure Go binaries, Rust, C/C++ without JIT.

   {{.B}}Writable Directory{{.R}} (--writable)
       Allows writing to the working directory. Switches from ReadOnlyPaths to
       ReadWritePaths. Logs are handled separately (always writable).

       {{.U}}Enable:{{.R}}  SQLite databases, local caches, uploaded file storage.
       {{.U}}Disable:{{.R}} Stateless services, external databases. Prevents binary mod.

   {{.B}}Runtime Directory{{.R}} (--runtime-dir)
       Creates /run/<name>/ owned by the service user. Uses tmpfs, auto-cleaned
       on service stop.

       {{.U}}Enable:{{.R}}  Unix socket servers, PID files, ephemeral runtime state.
       {{.U}}Disable:{{.R}} Services binding to TCP ports without socket files.

   {{.B}}Hardware Devices{{.R}} (--devices)
       Grants access to /dev (USB, serial, GPU). Disables PrivateDevices, adds
       AF_NETLINK for udev, adds user to dialout/plugdev groups.

       {{.U}}Enable:{{.R}}  IoT controllers, serial communication, GPU compute (CUDA).
       {{.U}}Disable:{{.R}} Web services, anything not directly talking to hardware.

   {{.B}}Full Device Access{{.R}} (--full-devices)
       Removes device sandboxing entirely. Sets DevicePolicy=none, removes
       DeviceAllow restrictions. Falls back to standard Unix permissions.

       {{.U}}Enable:{{.R}}  libusb applications, raw HID, when standard rules fail.
       {{.U}}Disable:{{.R}} If --devices alone works. Always try restricted mode first.

   {{.B}}Subprocesses{{.R}} (--subprocess)
       Allows executing external binaries. When disabled, masks /bin, /usr/bin,
       /sbin, /usr/sbin, /usr/local/bin via InaccessiblePaths.

       {{.U}}Enable:{{.R}}  Apps shelling out to ffmpeg, git, imagemagick.
       {{.U}}Disable:{{.R}} Self-contained binaries. Reduces attack surface drastically.

   {{.B}}Separate Logs Directory{{.R}} (--log-dir)
       Places logs in <path>/logs/ instead of <path>/. Setup script creates the
       directory with correct ownership.

       {{.U}}Enable:{{.R}}  Cleaner project root, easier to .gitignore.
       {{.U}}Disable:{{.R}} Single-file deployments, legacy apps expecting logs in root.

   {{.B}}Localhost Only{{.R}} (--localhost-only)
       Restricts network to 127.0.0.0/8 and ::1 using IPAddressAllow/Deny. The
       service can only communicate with localhost (databases, redis, etc).

       {{.U}}Enable:{{.R}}  Services talking only to local databases or caches.
       {{.U}}Disable:{{.R}} Anything needing external network access.

   {{.B}}Private Users{{.R}} (--private-users)
       Enables user namespace isolation. The service runs in a separate user
       namespace where it appears to be root but has no real privileges.

       {{.U}}Enable:{{.R}}  Maximum isolation for untrusted workloads.
       {{.U}}Disable:{{.R}} If service needs real user lookups or certain capabilities.
       {{.U}}Warning:{{.R}} May break NSS lookups, supplementary groups, or capabilities.

   {{.B}}CPU Quota{{.R}} (--cpu-quota)
       Limits CPU time as percentage. 100% = 1 core, 200% = 2 cores. Prevents
       runaway processes from starving other services.

       {{.U}}Example:{{.R}} --cpu-quota=150%  (1.5 cores max)

   {{.B}}Memory Max{{.R}} (--memory-max)
       Hard memory limit. Process is killed (OOM) if exceeded. Supports K, M, G
       suffixes.

       {{.U}}Example:{{.R}} --memory-max=2G  (2 gigabytes max)

{{.B}}ALWAYS-ON HARDENING{{.R}}
       These settings are always enabled with no option to disable:

       {{.B}}CoredumpFilter=0{{.R}}      Disables core dumps (prevents credential leaks)
       {{.B}}NoNewPrivileges=yes{{.R}}   Prevents privilege escalation via setuid
       {{.B}}ProtectSystem=strict{{.R}}  Root filesystem is read-only
       {{.B}}ProtectHome=yes{{.R}}       /home, /root, /run/user are inaccessible
       {{.B}}PrivateTmp=yes{{.R}}        Isolated /tmp and /var/tmp
       {{.B}}ProtectKernel*=yes{{.R}}    Kernel tunables, modules, logs protected

{{.B}}ENVIRONMENT FILE{{.R}}
       The --env-file option sets EnvironmentFile= in the unit. The file should
       contain KEY=VALUE pairs, one per line. Loaded by systemd before exec.

       Example:  mksvc myapp /opt/myapp --env-file=/opt/myapp/.env

       The env file is {{.U}}not{{.R}} managed by mksvc. Create it manually with proper
       permissions (chmod 600, owned by service user).

{{.B}}PERSISTENCE{{.R}}
       Configuration is saved to conf/svc.yml. On subsequent runs:
         - Without -i: Uses saved options directly
         - With -i: Saved options become defaults (press Enter to keep)
         - CLI flags always override saved options

       Custom additions to the .service file (Environment, TimeoutStartSec) are
       preserved across regeneration. Only mksvc-managed keys are reset.

{{.B}}EXAMPLES{{.R}}
       mksvc myapp /opt/myapp -i           # First-time setup with prompts
       mksvc                               # Regenerate with saved config
       mksvc myapp /opt/myapp --dry-run    # Preview without writing
       mksvc --writable                    # Override single option
       mksvc myapp /opt/myapp --no-listening --no-subprocess  # Scripted
       mksvc myapp /opt/myapp --memory-max=2G --cpu-quota=100%

{{.B}}FILES{{.R}}
       conf/svc.yml              Saved configuration
       conf/<name>.service       Systemd unit file
       conf/<name>.conf          Sysusers config (creates user/group)
       conf/<name>_logs.conf     Logrotate configuration
       conf/setup.sh             Installation script
       conf/uninstall.sh         Uninstallation script

{{.B}}AUTHOR{{.R}}
       Laura <github.com/coalaura>